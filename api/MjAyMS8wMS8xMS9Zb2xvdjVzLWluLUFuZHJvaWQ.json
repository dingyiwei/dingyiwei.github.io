{"title":"Yolov5s in Android","date":"2021-01-10T18:02:13.000Z","date_formatted":{"ll":"Jan 11, 2021","L":"01/11/2021","MM-DD":"01-11"},"link":"2021/01/11/Yolov5s-in-Android","tags":["Android","深度学习"],"updated":"2021-01-10T18:52:07.760Z","content":"<p>总结自 <a href=\"https://zhuanlan.zhihu.com/p/275989233\" target=\"_blank\">https://zhuanlan.zhihu.com/p/275989233</a> 。</p>\n<p>目前腾讯的 NCNN 似乎是在移动端上部署深度神经网络模型的最好的工具，PyTorch -&gt; ONNX -&gt; NCNN -&gt; Android。</p>\n<p>已有一个 Yolov5s.pt，我们可以：</p>\n<ol><li>通过 <a href=\"https://github.com/ultralytics/yolov5/issues/251\" target=\"_blank\">该issue</a> 中提到的 <code>export.py</code> 导出 onnx 模型<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ python models/export.py --weights yolov5s.pt --img 640 --batch 1</span><br></pre></td></tr></table></figure></li>\n<li>通过 onnx-simplifer 简化模型<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ python -m onnxsim yolov5s.onnx yolov5s-sim.onnx</span><br></pre></td></tr></table></figure></li>\n<li>通过 NCNN 的工具 onnx2ncnn 转换模型<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ onnx2ncnn yolov5s-sim.onnx yolov5s.param yolov5s.bin</span><br></pre></td></tr></table></figure></li>\n<li>此时报了一排 <code>Unsupported slice step !</code>，改掉开头 Split-Crop-Concat 的部分，详见 <a href=\"https://zhuanlan.zhihu.com/p/275989233；\" target=\"_blank\">https://zhuanlan.zhihu.com/p/275989233；</a></li>\n<li>通过 ncnnoptimize 工具自动修正 yolov5s.param，并降半精度<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ncnnoptimize yolov5s.param yolov5s.bin yolov5s-opt.param yolov5s-opt.bin 65536</span><br></pre></td></tr></table></figure></li>\n</ol>","next":{"title":"Yolov3 for Hikey970 & Kirin980","link":"2021/01/10/Yolov3-for-Hikey970"},"plink":"https://dingyiwei.github.io/2021/01/11/Yolov5s-in-Android/","reward":true,"copyright":{"license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"山猫","link":"<a href=\"https://dingyiwei.github.io/2021/01/11/Yolov5s-in-Android/\" title=\"Yolov5s in Android\">https://dingyiwei.github.io/2021/01/11/Yolov5s-in-Android/</a>"}}